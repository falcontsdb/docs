# 产品特性

### 时间分片

  海东青对数据以时间段范围进行分片（术语称之为Shard)，每一个分片作为一个独立单元负责其时间范围内数据的储存管理、读写以及过期管理。多个分片的数据是分开独立存储，每个分片内的数据文件可以进行合并压缩（由于进行了分片，因此需要合并的文件大大减少，从而减少了写放大）。单个分片若长时间没有写入或查询 （时间长度可以配置），则此分片所使用的内存和映射的文件资源可以释放，从而减轻系统压力。此外，主从同步是以Shard为单位，多个Shard并行同步。

  在指定时间范围的SQL查询中，海东青会根据SQL条件中的时间范围确定所涉及的分片，从而减少了需要读取的数据范围，缩短索引和数据的读取时间，最终获得更高的查询性能。

### 列式存储

  海东青是面向时序数据的分析型数据库，由于分析场景中实际需要的列较少，因此采用列式存储物理引擎，避免按照行存时需要读取所有列导致的性能问题。由于以列为单位且结合时间顺序进行存储，每个列某时间范围内的数据相似度非常高，因此利用采用差异压缩算法压缩数据以减少存储成本并提高查询速度。

### 预计算聚合查询优化

  分析场景中大多数查询属于聚合查询，常规的聚合查询实现需要读取大量原始数据，造成性能低下。海东青采用预计算进行优化。海东青在数据持久化时预先计算常用聚合查询（包括： min、max、sum、count、mean、spread）所需的结果，并将其持久化到数据文件中的索引段，那么在执行聚合查询时，若涉及到可利用预计算结果的聚合查询，则直接读取mmap的索引段（大多数时候已经缓存在内核中），从而避免读取原始数据所带来的IO和CPU开销，最终大幅提高聚合查询性能。

### 最近时间数据查询优化
  
  在时序场景中，用户除了对大量历史数据执行统计分析之外，还有很多需要查询最近最新数据的需求（比如查询多个传感器的最新指标、多个车辆的最新位置等；SQL语句则带有order by time desc limit从句）。若不采用特殊优化，则数据库需要读取大量数据进行时间排序以得到最新时间数据，其带来的IO和CPU开销将导致性能非常低下。因此海东青特别实现最近时间数据查询优化，其在数据写入的时候在内存中采用LRU维护最近数据的相关信息，在最近时间数据查询时，优先中LRU中进行查询，若LRU中的数据满足查询（比如limit要求），则无需读取数据文件，从而极大的提高查询性能。

### 乱序写入

  海东青支持无任何限制的时间乱序写入，并且支持写入任意时间（包括过去时间）的数据。

### 存储层加密

  海东青支持对数据库设置加密存储，从而提高数据安全性。在进行数据持久化到硬盘之前，海东青会通过用户配置的密钥加密数据，然后再将加密后的数据进行加密存储，在数据查询时，海东青会自动使用密钥解密数据，这一切都无需用户感知。

### MySQL协议

  MySQL是广泛使用的OLTP数据库，有大量的开发者熟悉MySQL的使用和开发，因此海东青兼容MySQL协议，可便于开发者上手海东青，用户可沿用已有MySQL的SQL语法、SDK或命令行工具操作海东青，提高开发效率。详见[MySQL协议](../developer/mysql.md)。

### Schema

  海东青支持Schema管理，可以创建表、添加字段、显示表字段。且海东青同时支持弱Schema语义和强Schema语义，两种Schema语义使用同一份Schema元数据。
  - 弱Schema

  海东青兼容InfluxDB协议，使用此协议时，无需手动创建表或添加字段就可写入数据，即写入的数据字段无需再当前表中存在，若写入当前不存在的字段，则会自动添加到数据表是Schema中。在查询时，可以不用关心查询的字段是否存在于表的Schema中，仍然可以成功执行（若字段不存在，则以null表示）。
  虽然InfluxDB协议下，采用弱Schema语义，但数据库仍然会自动维护Schema。（当然，InfluxDB协议下也仍然可以使用create table 或 alter table等语句主动维护Schema）
  - 强Schema
  
  海东青兼容MySQL协议，但使用此协议时，海东青采用强Schema语义。即在写入数据之前，必须保证写入的字段必须在当前表中存在，若写入不存在的字段则报错。在SQL数据查询时，若SQL涉及了不存在的列，也直接报错。
  注意，无论InfluxDB协议还是MySQL协议，所使用SQL语法是完全一致的，其Schema元数据也是共享的同一份。（比如可以使用 InfluxDB协议写入一个不存在的列以创建此列，随后再使用MySQL查询此列）