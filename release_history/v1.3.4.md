# v1.3.4

### 发布时间

2021/05/10

### Features

1. !499: 支持延迟加载下的limit快速查询。
1. !507: 减慢follower fetch snapshot失败后重试的速度，避免给主节点造成太大压力。
1. !502: 在添加索引之前先对series key进行去重，以提高从节点全量同步时做apply snapshot的速度。
1. !516: 优化oplog index刷盘逻辑, 减小锁范围, 提高数据写入速度。
1. !519: 用户认证失败达到上限自动锁定时记录审计日志。

1. 1. !535: 缓存打开的dir file对象以避免每次sync时都重新打开，以此减小sync dir机制对数据写入的性能损耗。
1. !545: 优化limit快速查询的生效范围。
1. !564: oplog增加failpoint测试并优化代码。
1. !592: 移除backup的legacy模式和restore的online、legacy模式，并增加一些错误检测。
1. !597: 备份/恢复添加鉴权、审计日志，且可兼容旧版本数据库。
1. !599: 新增冷备工具。
1. !606: 新增主从复制监控。
1. !605: 若没有提供 license 则数据库启动后进入试用模式，到试用期后数据库进入只读模式，直到被有效 license 激活。

### Bugfixes

1. !548: 修复从节点部分时间段查询数据缺失的问题。
1. !546: 修复添加NeedSnapshot日志后(且后续再无数据写入)导致无法cleanup oplog的问题。
1. !557: 修复从节点接收到日志后持久化失败而可能导致主节点写入超时的问题；增加主从复制下从节点的failpoint测试。
1. !569: 修复主节点可能没有同步最新的meta data给从节点的问题。
1. !570: 修复shard很多时主节点因为后台任务太多导致CPU负载高的问题。
1. !573: 修复平滑升级工具在有宕机节点情形下失效的问题。
1. !578: 修复从节点IO错误导致日志序号回退的问题。
1. !594: 重构备份工具，删除冗余参数，修复部分场景下备份文件为空的问题
1. !604: 修复重复的snapshot名称的问题。
1. !627: 从节点不写审计日志，修复从节点写审计日志导致同步异常的问题；metadata 状态数据与元数据分离，修复主节点 meta 修改后会重置从节点用户锁定状态的问题。
1. !633: 支持只读模式下手动解锁用户，以免从节点锁定用户后无法解锁。
1. !623: 处理Retain File之后并发执行close shard和获取shard写锁导致的死锁问题。
1. !630: 解决查询过程中关闭shard导致的死锁问题。
1. !634: 修复还原已删除shard group的问题
1. !653: 修正 replica manager 后台协程中 ticker 被错误设置的问题；减小 oplog cleaner 的默认配置值。
1. !657: 解决close shard可能较慢的问题（进而大幅减小主从切换时变更角色的时间）。
1. !681: 修复无法删除空 shard 的问题。

1. !520: 修复oplog的一些隐患。
1. !518: 修复磁盘满后数据库无法恢复的问题。
1. !523: 修复follower或learner的meta index可能大于leader的问题。



