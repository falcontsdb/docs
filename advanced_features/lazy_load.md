# 延迟加载

海东青数据库支持惰性的数据加载。通过启动时加载最新数据和按需加载历史数据的机制，在保证数据查询正确性的前提下，减少在启动过程中需要加载的数据量，缩短数据库的启动时间。 

# 适用场景

针对 Shard 数量较多导致数据库启动时间较长的场景，延迟加载可以有效降低数据库的启动时间。

但需要说明的是，在开启延迟加载后，数据库以下功能也可能会受较为明显的影响：

1. 对于 Statement 语句的影响

    - Select
    - DeleteSeries
    - DropMeasurement
    - DropSeries

对于执行目标为非加载 Shard 的以上几类查询和删除语句，相关请求的实际执行会阻塞至数据加载完成后开始。通过合理设置延迟加载参数，查询语句通常极少在非加载 Shard 上执行，影响可控；删除语句通常可以接受更大的延时，影响可控。

2. 对于写入的影响

对于未加载 Shard 的数据写入，相关请求的实际执行会阻塞至数据加载完成后开始。通过合理设置延迟加载参数，写入通常可以集中在已加载 Shard 上，影响可控。

因此，本功能默认为关闭状态，应根据用户具体业务场景酌情使用。

# 使用方法

```toml
[data]
  lazy-loading-enabled = true
  hot-shards = 5
```

延迟加载功能在配置文件中有两项， `lazy-loading-enabled`  是延迟加载功能开关，默认为关闭状态；`hot-shards` 用于控制实时加载的数据量，其数值表示每个保留策略（RP）下默认加载的 Shard 数量。

